<div class="appointments-list-container" @fadeInUp>
  <!-- Header Section -->
  <div class="list-header" @slideDown>
    <div class="header-content">
      <div>
        <h1 class="page-title">Appointments</h1>
        <p class="page-subtitle">Manage appointments and services</p>
      </div>
      <div class="header-actions d-flex align-items-center">
        <div class="btn-group me-2" role="group" aria-label="View toggle">
          <button
            class="btn btn-outline-secondary btn-sm"
            (click)="setView('professional')"
            [class.active]="viewMode() === 'professional'"
            [attr.aria-pressed]="viewMode() === 'professional'"
            title="Professional list"
            aria-label="Professional list"
          >
            <i class="bi bi-list-ul"></i>
          </button>
          <button
            class="btn btn-outline-secondary btn-sm"
            (click)="setView('cards')"
            [class.active]="viewMode() === 'cards'"
            [attr.aria-pressed]="viewMode() === 'cards'"
            title="Card view"
            aria-label="Card view"
          >
            <i class="bi bi-grid-3x3-gap"></i>
          </button>
        </div>

        <button class="btn btn-primary btn-sm" (click)="onNew()" aria-label="New appointment">
          <span class="btn-icon me-1"><i class="bi bi-plus"></i></span>
          New Appointment
        </button>
      </div>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-section" @slideDown>
    <div class="search-box">
      <span class="search-icon"><i class="bi bi-search"></i></span>
      <input
        type="text"
        class="search-input"
        placeholder="Search by customer, date or notes..."
        (input)="onSearchChange($any($event).target.value)"
        [attr.aria-label]="'Search appointments'"
      />
    </div>

    <div class="filter-controls">
      <select
        class="select-filter"
        (change)="onFilterChange($any($event).target.value)"
        [value]="filterStatus()"
        [attr.aria-label]="'Filter appointments'"
      >
        <option value="all">All</option>
        <option value="active">Active</option>
        <option value="closed">Closed</option>
        <option value="canceled">Canceled</option>
      </select>

      <select
        class="select-filter"
        (change)="onSortChange($any($event).target.value)"
        [attr.aria-label]="'Sort appointments'"
      >
        <option value="date">Sort by: Date</option>
        <option value="customer">Customer</option>
        <option value="duration">Duration</option>
      </select>
    </div>
  </div>

  <!-- Error State -->
  @if (error()) {
  <div class="error-state" @fadeInUp>
    <div class="error-content">
      <span class="error-icon"><i class="bi bi-exclamation-triangle-fill"></i></span>
      <div>
        <h3>Failed to load</h3>
        <p>{{ error() }}</p>
      </div>
      <button class="btn-retry" (click)="retryLoad()">Retry</button>
    </div>
  </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-grid" @fadeInUp>
    @for (i of [1, 2, 3, 4, 5, 6]; track i) {
    <div class="skeleton-card">
      <div class="skeleton skeleton-header"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-footer"></div>
    </div>
    }
  </div>
  }

  <!-- Cards Grid -->
  @if (!isLoading()) {
    @if (viewMode() === 'professional') {
      <div class="appointments-table table-responsive" @fadeInUp>
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>Code</th>
              <th>Customer</th>
              <th>Date</th>
              <th>Time</th>
              <th>Service</th>
              <th>Duration</th>
              <th>Store</th>
              @if (!isExpertNonCenterAdmin()) {
              <th>Technician</th>
              }
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (appointment of filteredAppointments(); track appointment.id) {
            <tr class="table-row" [class]="getStatusClass(appointment)">
              <td>{{ appointment.appointmentCode }}</td>
              <td>{{ appointment.customer }}</td>
              <td>{{ appointment.date | date: 'mediumDate' }}</td>
              <td>{{ appointment.time }}</td>
              <td>{{ getServiceTypeName(appointment) }}</td>
              <td>{{ appointment.duration }} min</td>
              <td>{{ getStoreName(appointment) }}</td>
              @if (!isExpertNonCenterAdmin()) {
              <td>{{ getTechnicianName(appointment) }}</td>
              }
              <td>
                <span [ngClass]="getStatusBadgeClasses(appointment)">
                  {{ getStatusBadge(appointment) }}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-outline-primary me-1" (click)="onView(appointment)" title="View details" aria-label="View appointment"><i class="bi bi-eye"></i></button>
                @if (!appointment.cloused && !appointment.canceled) {
                  <button class="btn btn-sm btn-outline-success" (click)="onEdit(appointment)" title="Edit" aria-label="Edit appointment"><i class="bi bi-pencil"></i></button>
                }
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="appointments-grid">
        @if (isEmptyState()) {
          <div class="empty-state" @fadeInUp>
            <div class="empty-icon"><i class="bi bi-calendar2-x"></i></div>
            <h3>No appointments</h3>
            <p>Start by creating your first appointment</p>
            <button class="btn-empty" (click)="onNew()">Create Appointment</button>
          </div>
        } @else {
          @for (appointment of filteredAppointments(); track appointment.id) {
            <div class="appointment-card" [class]="getStatusClass(appointment)" @cardEnter>
              <!-- Card Header -->
              <div class="card-header">
                <div class="status-badge">
                          <span [ngClass]="getStatusBadgeClasses(appointment)">{{ getStatusBadge(appointment) }}</span>
                        </div>
                <div class="card-actions">
                  <button
                    class="btn btn-sm btn-outline-secondary me-1"
                    (click)="onView(appointment)"
                    title="View details"
                    aria-label="View appointment details"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                  @if (!appointment.cloused && !appointment.canceled) {
                    <button
                      class="btn btn-sm btn-outline-secondary"
                      (click)="onEdit(appointment)"
                      title="Edit"
                      aria-label="Edit appointment"
                    >
                      <i class="bi bi-pencil"></i>
                    </button>
                  }
                  <!--button
                    class="btn-action btn-delete"
                    (click)="onDelete(appointment)"
                    title="Delete"
                    [attr.aria-label]="'Delete appointment'"
                  >
                    <i class="bi bi-trash"></i>
                  </button-->
                </div>
              </div>

              <!-- Appointment Info -->
              <div class="appointment-info">
                <h3 class="customer-name">{{ appointment.customer }}</h3>
                <p class="appointment-date"><i class="bi bi-calendar-event"></i> {{ appointment.date | date: 'medium' }} - {{ appointment.time }}</p>
              </div>

              <!-- Details Grid -->
              <div class="details-grid">
                <div class="detail-item">
                  <span class="detail-label"><i class="bi bi-tools"></i> Service</span>
                  <span class="detail-value">{{ getServiceTypeName(appointment) }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label"><i class="bi bi-clock"></i> Duration</span>
                  <span class="detail-value">{{ appointment.duration }} min</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label"><i class="bi bi-building"></i> Center</span>
                  <span class="detail-value">{{ getCenterName(appointment) }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label"><i class="bi bi-shop"></i> Store</span>
                  <span class="detail-value">{{ getStoreName(appointment) }}</span>
                </div>
              </div>

              <!-- Notes -->
              @if (appointment.notes) {
                <div class="notes-section">
                  <span class="notes-label"><i class="bi bi-card-text"></i> Notes</span>
                  <p class="notes-text">{{ appointment.notes }}</p>
                </div>
              }

              <!-- Card Footer -->
              <div class="card-footer">
                <span class="created-date">Created: {{ appointment.createdAt | date: 'short' }}</span>
              </div>
            </div>
          }
        }
      </div>
    }
  }

  <!-- Results Counter -->
  @if (!isLoading() && filteredAppointments().length > 0) {
  <div class="results-info">
    Showing {{ filteredAppointments().length }} of {{ appointments().length }} appointments
  </div>
  }
</div>
